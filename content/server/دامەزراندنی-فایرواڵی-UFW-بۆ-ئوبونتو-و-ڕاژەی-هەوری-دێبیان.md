---
layout: post
title: دامەزراندنی فایرواڵی UFW بۆ ئوبونتو و ڕاژەی هەوری دێبیان
tags: [ڕاژە]
date : "2018-08-17 05:35:45"
---

##### پێناسە:

یەکێک لە یەکەمین هێڵەکانی بەرگیری لە ئاسایشی ڕاژەی هەوری دامەزراندنی دیواری ئاگرە(firewall).لە ڕابردوو ئەم کارە زۆر بە ئاڵۆزی و دژواری ئەنجام دەبوو.زۆر کردار پێویست بوو. iptables ئێستا بە عینوانی نەرمەکالایێکی بەرگیری ڕاژە لە ئەمڕۆدا زۆر خوازیاری هەیە.بەڵام نیازی بە هەوڵێکی گونجا و عاقڵانە لە لایەن بەکارهێنەر بۆ فێر بوون و فام هەیە.ڕۆڵ(نەخش)ەکانی دیواری ئاگر شتیک نییە کە لە چەند چرکە فێر ببن.
بەم مەبەستە،UFW بە شیوەیێکی بەرچاو زۆر ئاسانتر و جێگیرترە .

##### UFW جییە ؟

UFW کورتکراوەی دیواریکی ئاگرینی بێ ئاڵۆزە(Uncomplicated Firewall)،کە لە نەرمەکالای iptables زۆر سادەتر و قەشەنگترە.ئامانجی ئەوەیە کە بەڕیوەبردنی دیواری ئاگر زۆر سادەتر بکات و ڕووخسارێکی بەکارهێنەر پەسەندی بێ بۆ سوودگرتن.هەروەها لە لایەن کۆمەڵگای گشتی بەکارهێنەرانی لینوکس زۆر بە باشی پاڵپشتی دەکرێت و لە سەر زۆر یەک لە دابەشکراوەکان لینوکس سوودی لێوەرگیراوە.هەروا هەڵبژاردەیێکی بەهێزە بۆ پاراستنی ئاسایشی ڕاژەکەتان.

##### پێش دەستپێکردن

سەرەتا، دەبێ دڵنیا ببین لەوە کە UFW دامەزراوە.لە ئوبونتو بە شێوازی پێش گریمان بوونی هەیە.بەڵام گەر دانەمەزرابوو بە هەر هۆکاریک، ئێوە دەتوانن بە فەرمانی خوارەوە دایمەزرێنن:

```shell
sudo aptitude install ufw
```

یا

```shell
sudo apt-get install ufw
```

##### پشکنینی بارودۆخ

ئێوە دەتوانن بارودۆخی UFW بە فەرمانەکەی خوارەوە ببینن

```shell
sudo ufw status
```

ئێستا، شایەت پێتان بڵێ ناچالاکە.بەهەرحاڵ کاتێک کە ufw چالاکە ئێوە ڕۆڵی دیواری ئاگرەکەتان شتێکە لەم شێوازە

```shell
Status: active

To Action From
-- ------ ----
22 ALLOW Anywhere
```

سوودلە IPv6 لە دیواری ئاگری UFW :
گەر ئێوە ڕاژەی خەیاڵیتان لە سەر IPv6 کانفیگ کردووە.دڵنیا بن کە UFW کانفیگکراوە بۆ پشتیوانی IPv6 ئینجا بۆ هەر دوو جۆری ئایپی واتە IPv4 وە IPv6 ڕۆڵەکانی بۆ کانفیگ بکەن.بۆ ئەم کارە فایلی کانفیگی UFW بەم فەرمانە بکەنەوە :

```shell
sudo vi /etc/default/ufw
```

دڵنیا بن لە “IPV6” کە بەرابەرە لەگەڵ “yes”،هاوشێوەی ئەمەیە :

```shell
IPV6=yes
```

پاشکەوتی بکەن و بێنەدەرەوە.بۆ وەگڕخستنی UFW پەیڕەوی بکەن لەم فەرمانە:

```shell
sudo ufw disable
sudo ufw enable
```

ئێستا بۆ دوو جۆر ئایپییەکە واتە IPv4 وە IPv6 کانفیگکراوە.

##### ڕێکخستنی پێشگریمان

یەکێ لەو شتانە کە هەر نەرمەکالای دیواری ئاگر ڕێکدەخات،سادەکردنی ناساندنی ڕۆڵەکان بۆ ئەنجامدانی یاساکانی پێش گریمان بۆ ڕێپێدان بە بەرگیری لە پەیویندیەکان و بەستنەوەی ڕاژەو تۆڕە.پێشگریمانەکانی UFW هەر هەمووی پەیوەندیەکانی هاتنەژوور قەپاتدەکەن و پەیوەندیەکانی چوونەدەرەیان کراوەکردووە.ئەمەش مانای وایە کە هەر کەسێک کە گەرەکی بێ بگەیێ بە ڕاژەی هەوریەکەتان توانای بەستنەوەو پەیوەندی نییە.لە کاتێکدا هەر بەرنامە لە ڕاژە دەتوانێ پەیوەندی بە جیهانی دەرەوە بگرێ. بۆ ڕێکخستنی ئەم پێشگریمانانە لەUFW ،لە فەرمانەکەی خوارەوە سوود دەگرین :

```shell
sudo ufw default deny incoming
```

وە

```shell
sudo ufw default allow outgoing
```

گەر هەرەکتانە کە مێ سنووردا بێ، دەتوانن داواکان بۆ دەرەوەش قەپات بکەن.هەر چەند پێویستی ئەم کردارە قسەی لەسەرە.بەڵام گەر ئێوە ڕاژەیێکی هەوری گشتیتان هەیە دەتوانن لە هەر جۆر پەیوەندی SSHبەرگیری بکەن.ئەمەش هۆکارێک بۆ بەڕێوەبردنی ئاسانە چوونکە دەبێ یاساکان بۆ تەواو پەیوەندیەکان ڕێکبخەن.ئێوە دەتوانن ئەمە بە شێوازی پێشگریمان بەم فەرمانە ڕێکبخەن :

```shell
sudo ufw default deny outgoing
```

##### ڕێگەدان بە پەیوەندی لە ڕاژە:

هەروا کە دەبینن پێکهاتەی ڕەستە(syntax) .ئێوە لە ترمیناڵ بە فەرمان دەتوانن یاساکانی دیواری ئاگر بگۆڕن.گەر ئێوە دیواری ئاگرتان چالاک کردووە. تەواو پەیوەندیەکان قەپاتدەکا.گەر ئیوە پەیوەندیتان گرتووە لە سەر SSH بۆ ڕاژەی هەوری.ئەمەش کێشەیێکە بۆ ئەوە کە ئێوە لە ڕاژەکەتاب قوفڵ دەبن بێڵن پەیوەندی SSH بە ڕاژەکەمان چالاک بکەین تا لەم قوفڵ بوونە بەرگیری بکەین.بەم فەرمانە:

```shell
sudo ufw allow ssh
```

بۆ زیادکردنی خزمەتگوزاریەکان زۆر سادەیە.UFW هاتووە بە فەرمانەکانی پێشگریمان بۆ سوودبینینی بەکارهێنەر . SSH ئێمە لە سەرەوە نمونەیێکە.لە ئەساسە بە شێوازیکی کورتە :

```shell
sudo ufw allow 22/tcp
```

ئەم فەرمانە ڕێمان پێدەدا بۆ پەیوەندی بە دەرگای ۲۲ کە لە پرۆتۆکۆلی TCP سوودی لێدەگرین.گەر SSH ڕاژە لە پۆرتی ۲۲۲۲ ڕێکخراوە ئێمە دەتوانین بەم فەرمانەی خوارەوە توانای بکەین :

```shell
sudo ufw allow 2222/tcp
```

##### پەیوەندیانە کە شایەت نیازمان پێیان بێ.

ئێستا کاتێکی باشە بۆ ئەو پەیوەندیانە کە ئیمکانەن پێویستیمان پێیان ببێ. گەر ئێمە دەستپێگەیشتنی ئاسایشی بۆ ڕاژەی وێبمان بە FTP بێ ،ئیمە پێویستمان بە یەکێک لەم فەرمانانەیە :

```shell
sudo ufw allow www
sudo ufw allow 80/tcp sudo ufw allow ftp
sudo ufw allow 21/tcp
```

باوڕی ئێوە بۆ ئەوە کە چ دەروازەیێکی پۆرت بکەنەوە، بە پێی نیازەکەتان جیاوازە.بەڵام کەمێ تاقیکردنەوەی پێویستە. بێجگە لەمانە گەر هەرەکتانە بزانن کە پەیوەندی ئێوە بە SSH ڕێیپێدراوە دەبێ لەم بابەتە دڵنیا بنەوە.

##### سنووری دەرگاکان(Port):

ئێوە دەتوانن لە UFW سنوور بخەنە سەر پۆرتێکی تایبەت.بۆ ڕێپێدان بەم دەرگاکان 1000 وە 2000 لەم فەرمانە سوود بگرن :

```shell
sudo ufw allow 1000:2000/tcp
```

گەر ئێوە نیازتان بە UDP هەیە.لەم فەرمانە سوود بگرن :

```shell
sudo ufw allow 1000:2000/udp
```

##### ناونیشانی ئای پی

ئێوە دەتوانن ئای پیێکی تایبەت دیاری بکەن.بۆ نمونە ،گەر من گەرەکم بە پەیوەندیەکان لە ئای پیێکی تایبەت دیاری بکەم(بۆ وێنە دەڵێن ناونیشانی ماڵەوە یان شوێنی ئیشکردن).لەم فەرمانە سوود دەگرم

```shell
sudo ufw allow from 192.168.255.255
```

##### ڕێگانەدان بە پەیوەندیێک :

بە شێوازی پێشگریمانی هەر هاتنەژوورەیێکی پەیوەندییەکان قەپاتکراوە.ئەمەش هۆکارێکە کە یاساکانی دیواری ئاگرەکەمان، سادەتر بێ. بۆ ئەوە کە ئێمە لە کاتی هەڵبژاردن ڕێپێدراوین کە بەشێک لە پۆرت و دەرگاکانی ئای پی بۆ پەیوەندی بە ڕاژە پەسەند بکەین.گەر هەرەکتانە قۆسمە بن و تەواو دەرگاو پۆرتەکانی ڕاژەکەتان بکەنەوە یا ئاوەڵای بکەن(پێسنیار ناکرێ) دەتوانن ڕێبدەن بە تەواو پەیوەندیەکان وە ئینجا ئەو سنوورانە کە گەرەکتان نییە دەستانپێیبگەیێ ئاستی”allow”(ڕێپێدان) بگۆڕن بە”deny”(ڕێگانەدان یان نکول).وەک ئەم نمونە :

```shell
sudo ufw allow 80/tcp
```

لە سەرەوە ڕێگەمان داوە بە پۆرتی 80

```shell
sudo ufw deny 80/tcp
```

بە فەرمانی سەرەوە بە پۆرتی 80 ڕێگامان نەداوە.

##### سڕینەوەیە یاساکان(Rules)

دوو هەڵبژاردە هەیە بۆ سڕینەوە یاساکان.سادەترین ڕێگا ئەوەیە لەم فەرمانە سوود بگرن :

```shell
sudo ufw delete allow ssh
```

ئێوە دەبینن کە ئێمە تەنها پێش یاساکە وشەی “delete”ـمان نووسی.نمونەیێکی دیکە :

```shell
sudo ufw delete allow 80/tcp
```

یان نمونەیێکی دیکە

```shell
sudo ufw delete allow 1000:2000/tcp
```

ئەمە کەمێ دژوارە کاتێک کە ئێوە پێرستێکی زۆرتان لەبەردەستە.ڕیگایێکی سادە.لە دوو قۆناغ، لەبابەتی ئەم فەرمانانە

```shell
sudo ufw status numbered
```

گەر ئێمە گەرکمان بێ لیستێک لە تەواو یاساکان لە لیستێکی ژمارەیی کۆ کەینەوە لەم فەرمانە سوود دەگرین :

```shell
sudo ufw delete [number]
```

[number] هێڵێکە لە فەرمانەکەی پێش.

##### وەگڕخستنەوە

پاش ئەو شتە کە ئێمە چاوەڕوانیمان دەکرد لە UFW و ڕێکخستنەکانمان ئەنجام دا،دەبێ UFW چالاک بکەین

```shell
sudo ufw enable
```

بۆ دیتنی بارودۆخی یاساکان کە بە دەرگاکانمان داوە، لەم فەرمانە بەهرە دەبەین

```shell
sudo ufw status
```

یان ئەمە

```shell
sudo ufw status verbose
```

بۆ زانیاری فرەتر.
گەر هەرەکمانە UFW بکوژێنینەوە واتە ناچالاکی بکەین لەم فەرمانە سوود دەبینین:

```shell
sudo ufw disable
```

##### ڕیکخستنەوەی هەموو شتێک :

بە هەر هۆکارێک ئەگەر ئێوە گەرەکتانە یاساکانی ڕاژەی هەوری بۆ پێشگریمان ڕێکبخەنەوە.بۆ ئەم مەبەستە تەنها ئەم فەرمانە بنووسن :

```shell
sudo ufw reset
```

سەرچاوە: [digitalocean](https://www.digitalocean.com/community/tutorials/how-to-setup-a-firewall-with-ufw-on-an-ubuntu-and-debian-cloud-server#before-we-get-started) 